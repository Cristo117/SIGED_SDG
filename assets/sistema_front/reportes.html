<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel SIGED - Reportes</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="layout">

        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">SIGED</h1>
                <p class="logo-subtitle">Sistema de Gestión</p>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a href="clientes.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="reportes.html" class="nav-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>
                <a href="ajustes.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Ajustes</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <p>&copy; 2025 SIGED System</p>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1 class="page-title">Reportes</h1>
                <div class="header-right">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">1</span>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar">AD</div>
                        <span class="user-name">Admin</span>
                    </div>
                </div>
            </header>

            <div class="content-area">
                <section class="reportes-section">
                    <div class="reportes-header">
                        <div>
                            <h2 class="section-title">Contabilidad y Procesos</h2>
                            <p class="section-subtitle">Gestión de procesos y facturación por cliente</p>
                        </div>
                        <div class="reportes-actions">
                            <button type="button" class="btn-config" id="btnConfigurar">
                                <i class="fas fa-cog"></i>
                                <span>Configurar Valores</span>
                            </button>
                            <button type="button" class="btn-asignar" id="btnAsignar">
                                <i class="fas fa-plus"></i>
                                <span>Asignar Proceso</span>
                            </button>
                        </div>
                    </div>

                    <div class="stats-cards">
                        <div class="stat-card stat-card-1">
                            <div class="stat-content">
                                <p class="stat-label">Ingresos Totales</p>
                                <p class="stat-value" data-value="2125000" data-prefix="$" data-format="number">0</p>
                                <p class="stat-sub">Todos los clientes</p>
                            </div>
                            <div class="stat-icon stat-icon-green">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="stat-card stat-card-2">
                            <div class="stat-content">
                                <p class="stat-label">Clientes Activos</p>
                                <p class="stat-value" data-value="3" data-format="number">0</p>
                                <p class="stat-sub">Con procesos</p>
                            </div>
                            <div class="stat-icon stat-icon-blue">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="stat-card stat-card-3">
                            <div class="stat-content">
                                <p class="stat-label">Total Procesos</p>
                                <p class="stat-value" data-value="6" data-format="number">0</p>
                                <p class="stat-sub">Realizados</p>
                            </div>
                            <div class="stat-icon stat-icon-purple">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="stat-card stat-card-4">
                            <div class="stat-content">
                                <p class="stat-label">Promedio por Cliente</p>
                                <p class="stat-value" data-value="708333" data-prefix="$" data-format="number">0</p>
                                <p class="stat-sub">Valor medio</p>
                            </div>
                            <div class="stat-icon stat-icon-orange">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-card">
                            <h3 class="chart-title">Top 5 Clientes</h3>
                            <p class="chart-subtitle">Clientes con mayor facturación</p>
                            <div class="chart-wrap">
                                <canvas id="chartTopClientes"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Ingresos por Tipo</h3>
                            <p class="chart-subtitle">Distribución por tipo de cliente</p>
                            <div class="chart-wrap chart-pie-wrap">
                                <canvas id="chartIngresosTipo"></canvas>
                            </div>
                            <div class="pie-legend" id="pieLegend"></div>
                        </div>
                    </div>

                    <div class="cuentas-section">
                        <h3 class="section-title">Cuentas de Clientes <span class="client-count">(3)</span></h3>
                        <p class="section-subtitle">Resumen de procesos y facturación por cliente</p>
                        <div class="table-card">
                            <table class="cuentas-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Tipo</th>
                                        <th>Afiliación</th>
                                        <th>Procesos</th>
                                        <th>Total Procesos</th>
                                        <th>Total General</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>María González</td>
                                        <td><span class="badge badge-type badge-independiente"><i class="fas fa-user"></i> Independiente</span></td>
                                        <td class="text-green">$250.000</td>
                                        <td>2</td>
                                        <td class="text-blue">$370.000</td>
                                        <td>$620.000</td>
                                        <td>
                                            <button type="button" class="btn-action btn-view" title="Ver detalles"><i class="fas fa-eye"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Empresa ABC S.A.S</td>
                                        <td><span class="badge badge-type badge-empleador"><i class="fas fa-building"></i> Empleador</span></td>
                                        <td class="text-green">$450.000</td>
                                        <td>2</td>
                                        <td class="text-blue">$685.000</td>
                                        <td>$1.135.000</td>
                                        <td>
                                            <button type="button" class="btn-action btn-view" title="Ver detalles"><i class="fas fa-eye"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Ana Martínez</td>
                                        <td><span class="badge badge-type badge-independiente"><i class="fas fa-user"></i> Independiente</span></td>
                                        <td class="text-green">$250.000</td>
                                        <td>2</td>
                                        <td class="text-blue">$740.000</td>
                                        <td>$990.000</td>
                                        <td>
                                            <button type="button" class="btn-action btn-view" title="Ver detalles"><i class="fas fa-eye"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </main>

    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script>
        (function() {
            function formatNumber(n) {
                return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            }

            function animateValue(el, start, end, duration, prefix) {
                prefix = prefix || '';
                var startTime = null;
                function step(timestamp) {
                    if (!startTime) startTime = timestamp;
                    var progress = Math.min((timestamp - startTime) / duration, 1);
                    var easeOut = 1 - Math.pow(1 - progress, 2);
                    var current = Math.floor(start + (end - start) * easeOut);
                    el.textContent = prefix + formatNumber(current);
                    if (progress < 1) requestAnimationFrame(step);
                    else el.textContent = prefix + formatNumber(end);
                }
                requestAnimationFrame(step);
            }

            function initStatCards() {
                var cards = document.querySelectorAll('.stat-card');
                cards.forEach(function(card, i) {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                });
                var observer = new IntersectionObserver(function(entries) {
                    entries.forEach(function(entry, idx) {
                        if (!entry.isIntersecting) return;
                        var card = entry.target;
                        card.style.transition = 'opacity 0.5s ease ' + (idx * 0.1) + 's, transform 0.5s ease ' + (idx * 0.1) + 's';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                        card.classList.add('stat-card-animated');
                        var valEl = card.querySelector('.stat-value');
                        if (!valEl) return;
                        var value = parseInt(valEl.getAttribute('data-value'), 10);
                        var prefix = valEl.getAttribute('data-prefix') || '';
                        animateValue(valEl, 0, value, 1200, prefix);
                        observer.unobserve(card);
                    });
                }, { threshold: 0.2 });
                cards.forEach(function(c) { observer.observe(c); });
            }

            function initCharts() {
                var ctxBar = document.getElementById('chartTopClientes').getContext('2d');
                new Chart(ctxBar, {
                    type: 'bar',
                    data: {
                        labels: ['Empresa ABC S.A.S', 'María González', 'Ana Martínez', 'Juan Pérez', 'Carlos R.'],
                        datasets: [{
                            label: 'Facturación',
                            data: [1135000, 620000, 990000, 450000, 380000],
                            backgroundColor: '#1a2049',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        animation: { duration: 1200 },
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    callback: function(v) { return formatNumber(v); }
                                },
                                grid: { color: 'rgba(0,0,0,0.06)' }
                            },
                            y: {
                                grid: { display: false }
                            }
                        }
                    }
                });

                var ctxPie = document.getElementById('chartIngresosTipo').getContext('2d');
                var pieData = {
                    labels: ['Empleadores: $1.135.000', 'Independientes: $990.000'],
                    datasets: [{
                        data: [1135000, 990000],
                        backgroundColor: ['#1a2049', '#fcc107'],
                        borderWidth: 0
                    }]
                };
                new Chart(ctxPie, {
                    type: 'doughnut',
                    data: pieData,
                    options: {
                        responsive: true,
                        animation: { animateRotate: true, animateScale: true, duration: 1000 },
                        plugins: {
                            legend: { display: false }
                        },
                        cutout: '60%'
                    }
                });
                var legend = document.getElementById('pieLegend');
                legend.innerHTML = '<span class="pie-legend-item" style="color:#1a2049"><i class="fas fa-circle"></i> Empleadores: $1.135.000</span><span class="pie-legend-item" style="color:#fcc107"><i class="fas fa-circle"></i> Independientes: $990.000</span>';
            }

            document.getElementById('btnConfigurar').addEventListener('click', function() {
                showToast('Configuración de valores (integrar con backend).');
            });
            document.getElementById('btnAsignar').addEventListener('click', function() {
                showToast('Asignar proceso (integrar con backend).');
            });
            document.querySelectorAll('.cuentas-table .btn-view').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    showToast('Ver detalle de cuenta (integrar con backend).');
                });
            });

            function showToast(msg) {
                var t = document.getElementById('toast');
                t.textContent = msg;
                t.className = 'toast toast-success show';
                setTimeout(function() { t.classList.remove('show'); }, 3000);
            }

            initStatCards();
            initCharts();
        })();
    </script>

</body>

</html>
